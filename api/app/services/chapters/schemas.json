{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Book + Chapters Data Model",
  "description": "Canonical schemas for Chapter and GameStory (Issue 0.2)",
  "definitions": {
    "Play": {
      "type": "object",
      "description": "The atomic unit of game action. A single play-by-play event.",
      "required": ["index", "event_type", "raw_data"],
      "properties": {
        "index": {
          "type": "integer",
          "minimum": 0,
          "description": "Position in the timeline (0-based)"
        },
        "event_type": {
          "type": "string",
          "minLength": 1,
          "description": "Type of event (pbp, social, etc.)"
        },
        "raw_data": {
          "type": "object",
          "description": "The complete event data from the feed"
        }
      },
      "additionalProperties": false
    },
    "TimeRange": {
      "type": "object",
      "description": "Time range for a chapter (game clock)",
      "required": ["start", "end"],
      "properties": {
        "start": {
          "type": ["string", "null"],
          "description": "Game clock at chapter start (e.g., '12:00', '2:30')"
        },
        "end": {
          "type": ["string", "null"],
          "description": "Game clock at chapter end (e.g., '10:45', '0:00')"
        }
      },
      "additionalProperties": false
    },
    "Chapter": {
      "type": "object",
      "description": "A contiguous range of plays representing a single narrative scene",
      "required": [
        "chapter_id",
        "play_start_idx",
        "play_end_idx",
        "play_count",
        "plays",
        "reason_codes",
        "period",
        "time_range"
      ],
      "properties": {
        "chapter_id": {
          "type": "string",
          "minLength": 1,
          "pattern": "^ch_[0-9]{3,}$",
          "description": "Unique identifier within game (e.g., 'ch_001')"
        },
        "play_start_idx": {
          "type": "integer",
          "minimum": 0,
          "description": "First play index (inclusive)"
        },
        "play_end_idx": {
          "type": "integer",
          "minimum": 0,
          "description": "Last play index (inclusive, >= play_start_idx)"
        },
        "play_count": {
          "type": "integer",
          "minimum": 1,
          "description": "Number of plays (computed: play_end_idx - play_start_idx + 1)"
        },
        "plays": {
          "type": "array",
          "minItems": 1,
          "items": {
            "$ref": "#/definitions/Play"
          },
          "description": "Ordered list of Play objects (non-empty, contiguous)"
        },
        "reason_codes": {
          "type": "array",
          "minItems": 1,
          "items": {
            "type": "string",
            "minLength": 1
          },
          "description": "Non-empty list explaining why boundaries exist (debugging/tuning)"
        },
        "period": {
          "type": ["integer", "null"],
          "minimum": 1,
          "description": "Period/quarter number (required if available, null if sport lacks periods)"
        },
        "time_range": {
          "oneOf": [
            {
              "$ref": "#/definitions/TimeRange"
            },
            {
              "type": "null"
            }
          ],
          "description": "Game clock range (null if PBP does not provide time)"
        }
      },
      "additionalProperties": false
    },
    "GameStory": {
      "type": "object",
      "description": "The authoritative output contract consumed by apps",
      "required": [
        "game_id",
        "sport",
        "chapter_count",
        "total_plays",
        "chapters",
        "compact_story"
      ],
      "properties": {
        "game_id": {
          "type": "integer",
          "minimum": 1,
          "description": "Database game ID (positive integer)"
        },
        "sport": {
          "type": "string",
          "minLength": 1,
          "enum": ["NBA", "NHL", "NFL", "MLB", "NCAAB", "NCAAF"],
          "description": "Sport identifier"
        },
        "chapter_count": {
          "type": "integer",
          "minimum": 1,
          "description": "Number of chapters (computed)"
        },
        "total_plays": {
          "type": "integer",
          "minimum": 1,
          "description": "Total plays across all chapters (computed)"
        },
        "chapters": {
          "type": "array",
          "minItems": 1,
          "items": {
            "$ref": "#/definitions/Chapter"
          },
          "description": "Ordered list of Chapter objects (non-empty, contiguous)"
        },
        "compact_story": {
          "type": ["string", "null"],
          "description": "AI-generated game summary (null at this phase, must exist in schema)"
        },
        "reading_time_estimate_minutes": {
          "type": ["number", "null"],
          "minimum": 0,
          "description": "Estimated reading time in minutes (optional)"
        },
        "metadata": {
          "type": "object",
          "description": "Extensible map for game metadata (teams, score, etc.)"
        }
      },
      "additionalProperties": false
    }
  }
}
